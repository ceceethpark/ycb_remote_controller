# PCA9555 I2C 12í‚¤ í‚¤ë³´ë“œ ì—…ë°ì´íŠ¸

## ğŸ“… ë³€ê²½ì¼ì: 2025-12-09

### ğŸ”„ ì£¼ìš” ë³€ê²½ì‚¬í•­

#### 1. í‚¤ë³´ë“œ ì‹œìŠ¤í…œ ì™„ì „ ë³€ê²½
- **ì´ì „**: GPIO ì§ì ‘ ì—°ê²° (4ê°œ ë²„íŠ¼)
- **ì´í›„**: PCA9555 I2C GPIO í™•ì¥ (12ê°œ ë²„íŠ¼)

#### 2. RemoteButton í´ë˜ìŠ¤ ì—…ë°ì´íŠ¸

##### í•˜ë“œì›¨ì–´ ì¸í„°í˜ì´ìŠ¤
```cpp
// ì´ì „ (GPIO ì§ì ‘)
GPIO 12, 13, 14, 27 - 4ê°œ ë²„íŠ¼

// ì´í›„ (I2C)
I2C SDA: GPIO 21
I2C SCL: GPIO 22
PCA9555 ì£¼ì†Œ: 0x20
ë²„íŠ¼: IOI_0 ~ IOI_11 (12ê°œ)
```

##### API ë³€ê²½
```cpp
// ë²„íŠ¼ ID ë³€ê²½
ì´ì „: BUTTON_1~4 (1~4)
ì´í›„: BUTTON_0~11 (0~11)

// ì´ˆê¸°í™” ë°˜í™˜ê°’ ì¶”ê°€
ì´ì „: void begin();
ì´í›„: bool begin();  // ì´ˆê¸°í™” ì„±ê³µ/ì‹¤íŒ¨ ë°˜í™˜
```

#### 3. LCD ë””ìŠ¤í”Œë ˆì´ ë ˆì´ì•„ì›ƒ
- 12ê°œ ë²„íŠ¼ì„ 3x4 ê·¸ë¦¬ë“œë¡œ í‘œì‹œ
- ë²„íŠ¼ ë¼ë²¨: K0 ~ K11
- ë” ì»´íŒ©íŠ¸í•œ ë²„íŠ¼ í¬ê¸° (70x35)
- ì‹¤ì‹œê°„ ìƒíƒœ ì—…ë°ì´íŠ¸

#### 4. ìƒˆë¡œìš´ ê¸°ëŠ¥
- I2C í†µì‹ ìœ¼ë¡œ GPIO í•€ ì ˆì•½
- ë” ë§ì€ ë²„íŠ¼ ì§€ì› (4ê°œ â†’ 12ê°œ)
- í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡° (ìµœëŒ€ 16ê°œê¹Œì§€)
- í†µí•©ëœ ì´ë²¤íŠ¸ ì²˜ë¦¬ ì‹œìŠ¤í…œ

### ğŸ“ ë³€ê²½ëœ íŒŒì¼

#### src/class/button/RemoteButton.h
```cpp
// ì¶”ê°€ëœ ìƒìˆ˜
static const uint8_t PCA9555_ADDRESS = 0x20;
static const uint8_t I2C_SDA = 21;
static const uint8_t I2C_SCL = 22;
static const uint8_t BUTTON_COUNT = 12;

// ì¶”ê°€ëœ ë ˆì§€ìŠ¤í„° ì •ì˜
static const uint8_t INPUT_PORT_0 = 0x00;
static const uint8_t INPUT_PORT_1 = 0x01;
static const uint8_t CONFIG_PORT_0 = 0x06;
static const uint8_t CONFIG_PORT_1 = 0x07;

// ì¶”ê°€ëœ í•¨ìˆ˜
bool writePCA9555(uint8_t reg, uint8_t value);
uint8_t readPCA9555(uint8_t reg);
uint16_t readAllButtons();
```

#### src/class/button/RemoteButton.cpp
```cpp
// PCA9555 ì´ˆê¸°í™”
bool RemoteButton::begin() {
    Wire.begin(I2C_SDA, I2C_SCL);
    Wire.setClock(400000);  // 400kHz Fast Mode
    
    // PCA9555 ì—°ê²° í™•ì¸
    Wire.beginTransmission(PCA9555_ADDRESS);
    if (Wire.endTransmission() != 0) {
        Serial.println("PCA9555 ì´ˆê¸°í™” ì‹¤íŒ¨!");
        return false;
    }
    
    // Port 0, 1ì„ ì…ë ¥ìœ¼ë¡œ ì„¤ì •
    writePCA9555(CONFIG_PORT_0, 0xFF);
    writePCA9555(CONFIG_PORT_1, 0x0F);  // í•˜ìœ„ 4ë¹„íŠ¸ë§Œ
    
    return true;
}

// 16ë¹„íŠ¸ ë²„íŠ¼ ìƒíƒœ ì½ê¸°
uint16_t RemoteButton::readAllButtons() {
    uint8_t port0 = readPCA9555(INPUT_PORT_0);
    uint8_t port1 = readPCA9555(INPUT_PORT_1);
    uint16_t buttons = ((uint16_t)port1 << 8) | port0;
    return buttons & 0x0FFF;  // 12ë¹„íŠ¸ë§Œ
}
```

#### src/class/lcd/RemoteLCD.cpp
```cpp
// 12ê°œ ë²„íŠ¼ì„ 3x4 ë ˆì´ì•„ì›ƒìœ¼ë¡œ í‘œì‹œ
void RemoteLCD::drawMainScreen() {
    clear();
    setTextSize(2);
    printTextCentered("ESP32 ë¦¬ëª¨ì»¨", 5, CYAN);
    
    // 3x4 ë²„íŠ¼ ê·¸ë¦¬ë“œ
    for (uint8_t i = 0; i < 12; i++) {
        uint8_t row = i / 4;
        uint8_t col = i % 4;
        uint16_t x = 10 + col * 75;
        uint16_t y = 35 + row * 40;
        drawButtonBox(x, y, 70, 35, i, false);
    }
    
    // ìƒíƒœ ë°”
    drawLine(0, 165, 320, 165, WHITE);
    setTextSize(1);
    printText("ë°°í„°ë¦¬: --% RSSI: --", 10, 170, GREEN);
    printText("ì—°ê²° ëŒ€ê¸°ì¤‘...", 10, 185, YELLOW);
}
```

#### src/main.cpp
```cpp
void setup() {
    // í‚¤ë³´ë“œ ì´ˆê¸°í™” ì˜¤ë¥˜ ì²˜ë¦¬ ì¶”ê°€
    if (!buttons.begin()) {
        Serial.println("PCA9555 ì´ˆê¸°í™” ì‹¤íŒ¨!");
        lcd.printTextCentered("í‚¤ë³´ë“œ ì˜¤ë¥˜!", 100, RED);
        while (1);  // ì¤‘ì§€
    }
    
    // í•¸ë“¤ëŸ¬ ì„¤ì •
    buttons.setHandlers(&lcd, &espNow);
}

void loop() {
    buttons.scan();
    buttons.processEvents();  // ìë™ ì´ë²¤íŠ¸ ì²˜ë¦¬
    led.update();
    espNow.update();
}
```

### ğŸ“š ìƒˆë¡œìš´ ë¬¸ì„œ
- `docs/pca9555-keyboard.md`: PCA9555 ì„¤ì • ì™„ì „ ê°€ì´ë“œ
- `docs/update-pca9555.md`: ì´ ì—…ë°ì´íŠ¸ ë¬¸ì„œ

### ğŸ”Œ í•˜ë“œì›¨ì–´ ì—…ë°ì´íŠ¸ í•„ìš”

```
ESP32 ì—°ê²°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ESP32          PCA9555            â”‚
â”‚GPIO 21 (SDA) â†’ SDA               â”‚
â”‚GPIO 22 (SCL) â†’ SCL               â”‚
â”‚3.3V          â†’ VCC               â”‚
â”‚GND           â†’ GND, A0, A1, A2  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë²„íŠ¼ ì—°ê²°:
IOI_0 ~ IOI_11 ê° ë²„íŠ¼ - GND
(PCA9555 ë‚´ë¶€ í’€ì—… ì‚¬ìš©)
```

### âœ… í…ŒìŠ¤íŠ¸ ë°©ë²•

1. **I2C ìŠ¤ìº”**: PCA9555 í™•ì¸ (ì£¼ì†Œ 0x20)
2. **ê°œë³„ ë²„íŠ¼**: ê° ë²„íŠ¼ ëˆŒëŸ¬ì„œ ì‹œë¦¬ì–¼ ëª¨ë‹ˆí„° í™•ì¸
3. **LCD í‘œì‹œ**: ë²„íŠ¼ ìƒíƒœê°€ ì‹œê°ì ìœ¼ë¡œ í™•ì¸
4. **ë¡±í”„ë ˆìŠ¤**: 1ì´ˆ ì´ìƒ ëˆŒëŸ¬ì„œ ì´ë²¤íŠ¸ í™•ì¸
5. **ë””ë°”ìš´ì‹±**: ê¹¨ë—í•œ ì…ë ¥ í™•ì¸

### âš ï¸ ì£¼ì˜ì‚¬í•­

- **ë²„íŠ¼ IDê°€ 0ë¶€í„° ì‹œì‘**ìœ¼ë¡œ ë³€ê²½ë¨ (ì´ì „ 1~4 â†’ í˜„ì¬ 0~11)
- I2C í’€ì—… ì €í•­ í•„ìš” (4.7kÎ©)
- PCA9555 ì£¼ì†Œê°€ A0~A2 ì„¤ì •ì— ë”°ë¼ ë³€ê²½ ê°€ëŠ¥
- ìµœëŒ€ 400kHz I2C ì†ë„ ì‚¬ìš©

### ğŸ“Š ì„±ëŠ¥ ë¹„êµ

| í•­ëª© | ì´ì „ (GPIO) | ì´í›„ (I2C) | ê°œì„  |
|------|-------------|------------|------|
| ë²„íŠ¼ ìˆ˜ | 4ê°œ | 12ê°œ | +200% |
| GPIO ì‚¬ìš© | 4í•€ | 2í•€ (I2C) | -50% |
| ìŠ¤ìº” ì†ë„ | ë§¤ìš° ë¹ ë¦„ | ë¹ ë¦„ (400kHz) | ì¶©ë¶„ |
| í™•ì¥ì„± | ì œí•œì  | ë§¤ìš° ì¢‹ìŒ | ++ |
| ë³µì¡ë„ | ë‚®ìŒ | ì¤‘ê°„ | + |
| ë¹„ìš© | ë‚®ìŒ | ì¤‘ê°„ | + |

### ğŸ”® í–¥í›„ ê°œì„  ê°€ëŠ¥

- ì¸í„°ëŸ½íŠ¸ í•€ ì‚¬ìš© (ë” ë¹ ë¥¸ ë°˜ì‘)
- 16ê°œ ë²„íŠ¼ ì „ì²´ ì‚¬ìš© (IOI_0~15)
- ë‹¤ì¤‘ PCA9555 ì—°ê²° (ë” ë§ì€ ë²„íŠ¼)
- LED ì¶œë ¥ë„ PCA9555ë¡œ ì œì–´

### ğŸ› ì•Œë ¤ì§„ ì´ìŠˆ

1. **I2C ì¶©ëŒ**: ë‹¤ë¥¸ I2C ì¥ì¹˜ì™€ ì£¼ì†Œ ì¶©ëŒ ê°€ëŠ¥
   - í•´ê²°: A0~A2 í•€ìœ¼ë¡œ ì£¼ì†Œ ë³€ê²½

2. **ìŠ¤ìº” ì§€ì—°**: I2C í†µì‹ ìœ¼ë¡œ ì•½ê°„ì˜ ì§€ì—°
   - í•´ê²°: 400kHz Fast Mode ì‚¬ìš©

3. **í’€ì—… ì €í•­**: ì—†ìœ¼ë©´ í†µì‹  ë¶ˆì•ˆì •
   - í•´ê²°: 4.7kÎ© ì €í•­ ì¶”ê°€

### ğŸ’¡ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

#### ì½”ë“œ ë³€ê²½ ë¶ˆí•„ìš”
`RemoteButton` í´ë˜ìŠ¤ APIëŠ” ë™ì¼í•˜ê²Œ ìœ ì§€ë˜ì–´ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”

#### í•˜ë“œì›¨ì–´ë§Œ ë³€ê²½
```cpp
// ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥
buttons.begin();
buttons.scan();
if (buttons.isButtonPressed(0)) {
    // ë²„íŠ¼ 0 ëˆŒë¦¼
}
```

#### ë²„íŠ¼ IDë§Œ í™•ì¸
- ì´ì „: ë²„íŠ¼ 1,2,3,4 â†’ ìƒˆë¡œìš´: ë²„íŠ¼ 0~11
- ë²„íŠ¼ ë²ˆí˜¸ê°€ 0ë¶€í„° ì‹œì‘í•˜ëŠ” ê²ƒë§Œ ì£¼ì˜

### ğŸ“– ì¶”ê°€ ì°¸ê³  ìë£Œ

- [PCA9555 ë°ì´í„°ì‹œíŠ¸](https://www.ti.com/product/PCA9555)
- [ESP32 I2C ê°€ì´ë“œ](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/i2c.html)
- [I2C í”„ë¡œí† ì½œ ì„¤ëª…](https://www.i2c-bus.org/)

### ğŸ‰ ì—…ë°ì´íŠ¸ ì™„ë£Œ!

ì´ì œ 12ê°œ ë²„íŠ¼ì„ ì‚¬ìš©í•˜ëŠ” ì™„ì „í•œ ë¦¬ëª¨ì»¨ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!
